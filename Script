task.spawn(function()
    local DEBUG = false
    local GLOBAL_BEST = 0

    local HttpService = game:GetService("HttpService")
    local Players = game:GetService("Players")
    local Workspace = game:GetService("Workspace")
    local TeleportService = game:GetService("TeleportService")

    local Player = Players.LocalPlayer

    local WEBHOOK_1M_10M = "https://discord.com/api/webhooks/1444263728446050455/iYXA8aaJOfWhlgCQ04YwW3vzraBAwIEvDi7-EdVgU--ACEXHktcwN69XuEarlVwD6ZR-"
    local WEBHOOK_10M_100M = "https://discord.com/api/webhooks/1444263853624918046/u2aeooCDow7VJnJ7kt8oGmylzWIIIIirbnse0VKs1EU_PZPiPUvW8duKk33Qh88xAIiU"
    local WEBHOOK_100M_INF = "https://discord.com/api/webhooks/1444263961573724180/8m_9-VsRfxaRU_D7LmUqIM4iVEKP_QlGSdvW1RiC4juu6tkfipBiC3Q-QSQnm4N4XU5_"

    local function Request()
        return (syn and syn.request)
        or http_request
        or (http and http.request)
        or request
    end

    local function parseGen(text)
        if not text then return 0 end
        if text == "âˆž" then return math.huge end
        text = text:upper()
        local n = tonumber(text:gsub("[^%d%.]", ""))
        if not n then return 0 end
        if text:find("M") then n *= 1e6 end
        if text:find("K") then n *= 1e3 end
        return n
    end

    local function getPlotBrainrots(plot)
        local list = {}
        for _, obj in ipairs(plot:GetDescendants()) do
            if obj.Name == "AnimalOverhead" then
                local dn = obj:FindFirstChild("DisplayName")
                local gn = obj:FindFirstChild("Generation")
                if dn and gn then
                    table.insert(list,{
                        Name = dn.Text,
                        MPS = gn.Text,
                        NumMPS = parseGen(gn.Text)
                    })
                end
            end
        end
        table.sort(list,function(a,b) return a.NumMPS > b.NumMPS end)
        return list
    end

    local function getBestInServer()
        local best, bestPlot
        local plots = Workspace:FindFirstChild("Plots")
        if not plots then return nil,nil end

        for _, plot in ipairs(plots:GetChildren()) do
            local list = getPlotBrainrots(plot)
            if #list > 0 then
                if not best or list[1].NumMPS > best.NumMPS then
                    best = list[1]
                    bestPlot = plot
                end
            end
        end
        return best, bestPlot
    end

    while task.wait(4) do
        local best, plot = getBestInServer()
        if best and best.NumMPS > GLOBAL_BEST then
            GLOBAL_BEST = best.NumMPS

            local list = getPlotBrainrots(plot)
            local lines = {}
            for i, b in ipairs(list) do
                local emoji = (i == 1 and "ðŸ‘‘") or (i == 2 and "ðŸ¥ˆ") or (i == 3 and "ðŸ¥‰") or "ðŸ’Ž"
                table.insert(lines, emoji .. " " .. b.Name .. " â€” $" .. b.MPS)
                if i >= 10 then break end
            end

            local url, ping = WEBHOOK_1M_10M, false
            if best.NumMPS >= 1e8 or best.NumMPS == math.huge then
                url = WEBHOOK_100M_INF
                ping = true
            elseif best.NumMPS >= 1e7 then
                url = WEBHOOK_10M_100M
            end

            local embed = {
                title = string.format("1x %s ($%s)", best.Name, best.MPS),
                color = 0x5865F2,
                fields = {
                    {name="ðŸ§± Brainrots in Base", value="```\n"..table.concat(lines,"\n").."\n```"},
                    {name="ðŸ†” Server ID", value="```"..game.JobId.."```"},
                    {
                        name="ðŸ“œ Join Script",
                        value=string.format(
                            "```lua\ngame:GetService(\"TeleportService\"):TeleportToPlaceInstance(%d, \"%s\", game.Players.LocalPlayer)\n```",
                            game.PlaceId, game.JobId
                        )
                    },
                    {name="ðŸ¤– Bot", value="```"..Player.Name.."```"},
                    {name="ðŸ‘¥ Players", value="```"..#Players:GetPlayers().."/"..Players.MaxPlayers.."```"}
                },
                footer = {text=os.date("%Y-%m-%d %H:%M")},
                timestamp=os.date("!%Y-%m-%dT%H:%M:%SZ")
            }

            local payload = ping
                and HttpService:JSONEncode({content="@everyone", embeds={embed}})
                or HttpService:JSONEncode({embeds={embed}})

            local req = Request()
            if req then
                pcall(req, {
                    Url = url,
                    Method = "POST",
                    Headers = {["Content-Type"]="application/json"},
                    Body = payload
                })
            end

            if DEBUG then warn("Found new highest â€” hopping in 4s") end
            task.wait(4)
            TeleportService:Teleport(game.PlaceId)

        else
            if DEBUG then warn("No better â€” hopping in 4s") end
            task.wait(4)
            TeleportService:Teleport(game.PlaceId)
        end
    end
end)
