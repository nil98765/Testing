task.spawn(function()
    local HttpService = game:GetService("HttpService")
    local Players = game:GetService("Players")
    local Workspace = game:GetService("Workspace")
    local TeleportService = game:GetService("TeleportService")

    local Player = Players.LocalPlayer
    local DEBUG = false

    -- YOUR WEBHOOKS
    local WEBHOOK_1M_10M = "https://discord.com/api/webhooks/WEBHOOK1"
    local WEBHOOK_10M_100M = "https://discord.com/api/webhooks/WEBHOOK2"
    local WEBHOOK_100M_INF = "https://discord.com/api/webhooks/WEBHOOK3"

    -- Executor compatible HTTP request sender
    local function sendRequest(url, payload)
        local encoded = HttpService:JSONEncode(payload)
        local req = (syn and syn.request) or http_request or (http and http.request) or request
        if not req then
            warn("âŒ HTTP requests unsupported in this executor!")
            return
        end
        pcall(function()
            req({
                Url = url,
                Method = "POST",
                Headers = {["Content-Type"] = "application/json"},
                Body = encoded
            })
        end)
    end

    -- Parse MPS text like "$2.5M"
    local function parseGen(text)
        if not text then return 0 end
        local s = tostring(text):gsub("[%s$,]", ""):upper()
        if s == "âˆž" then return math.huge end
        local num = tonumber(s:match("[%d%.]+") or "0") or 0
        if s:find("M") then num *= 1e6 end
        if s:find("K") then num *= 1e3 end
        return num
    end

    local function safeTextValue(obj)
        return obj and (obj.Text or obj.Value and tostring(obj.Value) or nil)
    end

    -- Get all brainrots in a plot
    local function getPlotBrainrots(plot)
        local list = {}
        for _, obj in ipairs(plot:GetDescendants()) do
            if obj.Name == "AnimalOverhead" then
                local nameText = safeTextValue(obj:FindFirstChild("DisplayName")) or "Unknown"
                local genText  = safeTextValue(obj:FindFirstChild("Generation")) or "0"
                table.insert(list, {
                    Name = nameText,
                    MPS = genText,
                    NumMPS = parseGen(genText)
                })
            end
        end
        table.sort(list, function(a,b) return a.NumMPS > b.NumMPS end)
        return list
    end

    -- Find best Brainrot across all plots
    local function getBestInServer()
        local best, bestPlot
        local plots = Workspace:FindFirstChild("Plots")
        if not plots then return nil end
        for _, plot in ipairs(plots:GetChildren()) do
            local list = getPlotBrainrots(plot)
            if #list > 0 then
                local candidate = list[1]
                if not best or candidate.NumMPS > best.NumMPS then
                    best = candidate
                    bestPlot = plot
                end
            end
        end
        return best, bestPlot
    end

    -- MAIN LOOP (runs forever)
    while task.wait(5) do
        local best, plot = getBestInServer()
        local bestNum = best and best.NumMPS or 0
        
        if best and bestNum >= 1e6 then -- Only send if â‰¥1M MPS
            local list = getPlotBrainrots(plot)
            local lines = {}
            for i, b in ipairs(list) do
                local emoji = (i == 1 and "ðŸ‘‘") or (i == 2 and "ðŸ¥ˆ") or (i == 3 and "ðŸ¥‰") or "ðŸ’Ž"
                table.insert(lines, emoji .. " " .. (b.Name or "Unknown") .. " â€” $" .. (b.MPS or "0"))
                if i >= 10 then break end
            end

            -- Select webhook based on tiers
            local url = WEBHOOK_1M_10M
            local ping = false
            if bestNum >= 1e8 then
                url = WEBHOOK_100M_INF
                ping = true
            elseif bestNum >= 1e7 then
                url = WEBHOOK_10M_100M
            end

            local playerName = Player and Player.Name or "Unknown"
            local playersCount = #Players:GetPlayers()
            local maxPlayers = Players.MaxPlayers or "N/A"

            local embed = {
                title = string.format("1x %s ($%s)", best.Name or "Unknown", best.MPS or "0"),
                color = 0x5865F2,
                fields = {
                    {name = "ðŸ§± Brainrots in Base", value = "```\n" .. table.concat(lines, "\n") .. "\n```"},
                    {name = "ðŸ†” Server ID", value = "```".. tostring(game.JobId) .. "```"},
                    {name = "ðŸ“œ Join Script", value = string.format("```lua\ngame:GetService(\"TeleportService\"):TeleportToPlaceInstance(%d, \"%s\", game.Players.LocalPlayer)\n```", game.PlaceId, game.JobId)},
                    {name = "ðŸ¤– Bot", value = "```" .. playerName .. "```"},
                    {name = "ðŸ‘¥ Players", value = "```" .. tostring(playersCount) .. "/" .. tostring(maxPlayers) .. "```"}
                },
                footer = {text = os.date("%Y-%m-%d %H:%M")},
                timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
            }

            sendRequest(url, ping and {content = "@everyone", embeds = {embed}} or {embeds = {embed}})
        end

        -- ALWAYS server hop, even if nothing found
        pcall(function()
            TeleportService:Teleport(game.PlaceId)
        end)
    end
end)
